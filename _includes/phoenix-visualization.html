<!-- Phoenix Visualization Platform Integration -->
<!-- é›¶æ•…éšœå¾®æœåŠ¡å¯è§†åŒ–å¹³å°é›†æˆ -->

<!-- æ ·å¼è¡¨ -->
<link rel="stylesheet" href="{{ '/assets/css/phoenix-visualization.css' | relative_url }}">

<!-- ä¸»è„šæœ¬ -->
<script src="{{ '/assets/js/phoenix-visualization.js' | relative_url }}"></script>

<!-- æ€§èƒ½ç›‘æ§é¢æ¿ï¼ˆå¯é€‰ï¼‰ -->
{% if site.phoenix_debug %}
<div class="phoenix-monitor-panel" id="phoenix-monitor" style="display: none;">
  <div class="phoenix-monitor-title">ğŸš€ Phoenixç›‘æ§</div>
  <div class="phoenix-monitor-content">
    <div class="phoenix-monitor-item">
      <span>ç³»ç»ŸçŠ¶æ€:</span>
      <span class="phoenix-monitor-value" id="phoenix-status">åŠ è½½ä¸­...</span>
    </div>
    <div class="phoenix-monitor-item">
      <span>æˆåŠŸç‡:</span>
      <span class="phoenix-monitor-value" id="phoenix-success">-</span>
    </div>
    <div class="phoenix-monitor-item">
      <span>å“åº”æ—¶é—´:</span>
      <span class="phoenix-monitor-value" id="phoenix-response">-</span>
    </div>
  </div>
</div>

<script>
// æ˜¾ç¤ºç›‘æ§é¢æ¿
document.addEventListener('DOMContentLoaded', function() {
  const monitor = document.getElementById('phoenix-monitor');
  if (monitor) {
    monitor.style.display = 'block';
    
    // æ›´æ–°ç›‘æ§æ•°æ®
    setInterval(() => {
      const report = Phoenix.getReport();
      document.getElementById('phoenix-status').textContent = 
        report.successRate >= 90 ? 'å¥åº·' : report.successRate >= 70 ? 'è­¦å‘Š' : 'æ•…éšœ';
      document.getElementById('phoenix-success').textContent = report.successRate + '%';
      document.getElementById('phoenix-response').textContent = report.avgResponseTime + 'ms';
    }, 5000);
  }
});
</script>
{% endif %}

<!-- ä¸»é¢˜åˆ‡æ¢æ”¯æŒ -->
<script>
// ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
function emitThemeChange() {
  const event = new CustomEvent('themeChanged');
  document.dispatchEvent(event);
}

// ç›‘å¬ä¸»é¢˜å˜åŒ–
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.attributeName === 'data-theme') {
      emitThemeChange();
    }
  });
});

observer.observe(document.documentElement, {
  attributes: true,
  attributeFilter: ['data-theme']
});
</script>

<!-- é”™è¯¯å¤„ç† -->
<script>
// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', function(e) {
  if (e.filename && e.filename.includes('phoenix')) {
    console.error('Phoenixé”™è¯¯:', e.message);
    // å¯ä»¥å‘é€åˆ°é”™è¯¯æ”¶é›†æœåŠ¡
  }
});

// æœªå¤„ç†çš„Promiseæ‹’ç»
window.addEventListener('unhandledrejection', function(e) {
  console.error('Phoenix Promiseé”™è¯¯:', e.reason);
});
</script>

<!-- é”®ç›˜å¿«æ·é”® -->
<script>
document.addEventListener('keydown', function(e) {
  // Ctrl+Shift+P æ‰“å¼€æ€§èƒ½ç›‘æ§
  if (e.ctrlKey && e.shiftKey && e.key === 'P') {
    e.preventDefault();
    const monitor = document.getElementById('phoenix-monitor');
    if (monitor) {
      monitor.style.display = monitor.style.display === 'none' ? 'block' : 'none';
    }
  }
});
</script>
