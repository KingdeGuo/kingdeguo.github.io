<!-- Phoenix Visualization Platform Integration -->
<!-- 零故障微服务可视化平台集成 -->

<!-- 样式表 -->
<link rel="stylesheet" href="{{ '/assets/css/phoenix-visualization.css' | relative_url }}">

<!-- 主脚本 -->
<script src="{{ '/assets/js/phoenix-visualization.js' | relative_url }}"></script>

<!-- 性能监控面板（可选） -->
{% if site.phoenix_debug %}
<div class="phoenix-monitor-panel" id="phoenix-monitor" style="display: none;">
  <div class="phoenix-monitor-title">🚀 Phoenix监控</div>
  <div class="phoenix-monitor-content">
    <div class="phoenix-monitor-item">
      <span>系统状态:</span>
      <span class="phoenix-monitor-value" id="phoenix-status">加载中...</span>
    </div>
    <div class="phoenix-monitor-item">
      <span>成功率:</span>
      <span class="phoenix-monitor-value" id="phoenix-success">-</span>
    </div>
    <div class="phoenix-monitor-item">
      <span>响应时间:</span>
      <span class="phoenix-monitor-value" id="phoenix-response">-</span>
    </div>
  </div>
</div>

<script>
// 显示监控面板
document.addEventListener('DOMContentLoaded', function() {
  const monitor = document.getElementById('phoenix-monitor');
  if (monitor) {
    monitor.style.display = 'block';
    
    // 更新监控数据
    setInterval(() => {
      const report = Phoenix.getReport();
      document.getElementById('phoenix-status').textContent = 
        report.successRate >= 90 ? '健康' : report.successRate >= 70 ? '警告' : '故障';
      document.getElementById('phoenix-success').textContent = report.successRate + '%';
      document.getElementById('phoenix-response').textContent = report.avgResponseTime + 'ms';
    }, 5000);
  }
});
</script>
{% endif %}

<!-- 主题切换支持 -->
<script>
// 主题切换事件
function emitThemeChange() {
  const event = new CustomEvent('themeChanged');
  document.dispatchEvent(event);
}

// 监听主题变化
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.attributeName === 'data-theme') {
      emitThemeChange();
    }
  });
});

observer.observe(document.documentElement, {
  attributes: true,
  attributeFilter: ['data-theme']
});
</script>

<!-- 错误处理 -->
<script>
// 全局错误处理
window.addEventListener('error', function(e) {
  if (e.filename && e.filename.includes('phoenix')) {
    console.error('Phoenix错误:', e.message);
    // 可以发送到错误收集服务
  }
});

// 未处理的Promise拒绝
window.addEventListener('unhandledrejection', function(e) {
  console.error('Phoenix Promise错误:', e.reason);
});
</script>

<!-- 键盘快捷键 -->
<script>
document.addEventListener('keydown', function(e) {
  // Ctrl+Shift+P 打开性能监控
  if (e.ctrlKey && e.shiftKey && e.key === 'P') {
    e.preventDefault();
    const monitor = document.getElementById('phoenix-monitor');
    if (monitor) {
      monitor.style.display = monitor.style.display === 'none' ? 'block' : 'none';
    }
  }
});
</script>
