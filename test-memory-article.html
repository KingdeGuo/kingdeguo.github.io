<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大模型记忆文章测试</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }
        code {
            font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;
        }
    </style>
</head>
<body>
    <h1>大模型记忆机制测试页面</h1>
    
    <h2>1. Mermaid图表测试</h2>
    
    <h3>无状态调用问题</h3>
    <div class="mermaid">
        graph TD
            A[用户: "设置提醒下午3点开会"] --> B[LLM API调用];
            B --> C[AI: "好的，已设置提醒"];
            
            D[用户: "我设置了什么提醒？"] --> E[新的LLM API调用];
            E --> F[AI: "我不知道您设置了什么提醒"];
            
            style B fill:#ffcccc
            style E fill:#ffcccc
    </div>

    <h3>记忆方案选择决策树</h3>
    <div class="mermaid">
        graph TD
            A[开始选择记忆方案] --> B{对话长度？}
            B -->|短对话 < 10轮| C[BufferMemory]
            B -->|长对话 > 10轮| D{是否需要完整历史？}
            
            D -->|是| E{是否有关键早期信息？}
            E -->|是| F[VectorMemory]
            E -->|否| G[WindowMemory]
            
            D -->|否| H{是否接受额外延迟？}
            H -->|是| I[SummaryMemory]
            H -->|否| J[WindowMemory]
    </div>

    <h2>2. 代码高亮测试</h2>
    
    <h3>Python代码示例</h3>
    <pre><code class="language-python">from langchain.memory import ConversationBufferMemory
from langchain_openai import ChatOpenAI
from langchain.chains import ConversationChain
import os

# 设置API密钥
os.environ["OPENAI_API_KEY"] = "your-api-key-here"

# 初始化模型和记忆
llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0.7)
memory = ConversationBufferMemory(return_messages=True)

# 创建对话链
conversation = ConversationChain(
    llm=llm,
    memory=memory,
    verbose=True  # 显示完整的prompt
)

# 开始对话
response = conversation.predict(input="你好，我是程序员小李")
print(f"AI: {response}")
</code></pre>

    <h2>3. 性能对比表格</h2>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f3f4f6;">
                <th style="padding: 12px;">记忆类型</th>
                <th style="padding: 12px;">实现复杂度</th>
                <th style="padding: 12px;">Token消耗</th>
                <th style="padding: 12px;">信息保留度</th>
                <th style="padding: 12px;">响应速度</th>
                <th style="padding: 12px;">适用场景</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 12px;"><strong>BufferMemory</strong></td>
                <td style="padding: 12px;">⭐</td>
                <td style="padding: 12px;">🔴高</td>
                <td style="padding: 12px;">🟢完整</td>
                <td style="padding: 12px;">⚡快</td>
                <td style="padding: 12px;">教学演示</td>
            </tr>
            <tr>
                <td style="padding: 12px;"><strong>WindowMemory</strong></td>
                <td style="padding: 12px;">⭐⭐</td>
                <td style="padding: 12px;">🟡中</td>
                <td style="padding: 12px;">🟡部分</td>
                <td style="padding: 12px;">⚡快</td>
                <td style="padding: 12px;">通用聊天</td>
            </tr>
            <tr>
                <td style="padding: 12px;"><strong>SummaryMemory</strong></td>
                <td style="padding: 12px;">⭐⭐⭐</td>
                <td style="padding: 12px;">🟢低</td>
                <td style="padding: 12px;">🟡摘要</td>
                <td style="padding: 12px;">🐌慢</td>
                <td style="padding: 12px;">长对话</td>
            </tr>
            <tr>
                <td style="padding: 12px;"><strong>VectorMemory</strong></td>
                <td style="padding: 12px;">⭐⭐⭐⭐</td>
                <td style="padding: 12px;">🟢很低</td>
                <td style="padding: 12px;">🟢精准</td>
                <td style="padding: 12px;">🟡中</td>
                <td style="padding: 12px;">知识库</td>
            </tr>
        </tbody>
    </table>

    <script>
        // 初始化Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>
